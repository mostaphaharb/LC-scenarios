---
title: "Demand_prj_Sc"
author: "MHarb"
date: "20/10/2020"
output: powerpoint_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## R Markdown

This is an R Markdown presentation. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

## Slide with Bullets

- Bullet 1
- Bullet 2
- Bullet 3

## Slide with R Output

```{r cars, echo = TRUE}
summary(cars)
```

## Slide with Plot

```{r pressure}
plot(pressure)
```

```{r}
#source 1: https://www.datanovia.com/en/lessons/transform-data-to-normal-distribution-in-r/

#Drawing the raw data
library(ggpubr)
library(moments)
library(ggplot2)
library(bestNormalize)
#Demo data ElKaala Province growth rates
GrowthRates <- read.csv("Kaala_Data_GR.csv")
 
head(GrowthRates)

# Distribution of Plantation growth rate variable
ggdensity(GrowthRates, x = "Plantation_GR", fill = "lightgray", title = "Plantation") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Distribution of crops growth rate variable
ggdensity(GrowthRates, x = "Crops_GR", fill = "lightgray", title = "crops") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Distribution of Rainfed growth rate variable
ggdensity(GrowthRates, x = "Rainfed_GR", fill = "lightgray", title = "Rainfed") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Distribution of Irrigated growth rate variable
ggdensity(GrowthRates, x = "Irrigated_GR", fill = "lightgray", title = "Irrigated") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")
# Distribution of Total_Agri variable

ggdensity(GrowthRates, x = "Total_GR", fill = "lightgray", title = "Total_Agri") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")



# Store the transformation objects
yj_Plantation <- yeojohnson(GrowthRates$Plantation_GR,standardize=TRUE)
yj_Crops <- yeojohnson(GrowthRates$Crops_GR,standardize=TRUE)
yj_Rainfed <- yeojohnson(GrowthRates$Rainfed_GR,standardize=TRUE)
yj_Irrigated <- yeojohnson(GrowthRates$Irrigated_GR,standardize=TRUE)
yj_Total <- yeojohnson(GrowthRates$Total_GR,standardize=TRUE)

# # Perform transformation
yj_Plantation_vals <- predict(yj_Plantation)
yj_Crops_vals <- predict(yj_Crops)
yj_Rainfed_vals <- predict(yj_Rainfed)
yj_Irrigated_vals <- predict(yj_Irrigated)
yj_Total_vals <- predict(yj_Total)

skewness(GrowthRates$Plantation_GR, na.rm = TRUE)
skewness(GrowthRates$Crops_GR, na.rm = TRUE)
skewness(GrowthRates$Rainfed_GR, na.rm = TRUE)
skewness(GrowthRates$Irrigated_GR, na.rm = TRUE)
skewness(GrowthRates$Total_GR, na.rm = TRUE)
  
skewness(yj_Plantation_vals, na.rm = TRUE)
skewness(yj_Crops_vals, na.rm = TRUE)
skewness(yj_Rainfed_vals, na.rm = TRUE)
skewness(yj_Irrigated_vals, na.rm = TRUE)
skewness(yj_Total_vals, na.rm = TRUE)

#storing in a file
dfrm <- data.frame(yj_Plantation_vals=yj_Plantation_vals,yj_Crops_vals=yj_Crops_vals,yj_Rainfed_vals=yj_Rainfed_vals,yj_Irrigated_vals=yj_Irrigated_vals,yj_Total_vals=yj_Total_vals)
write.table(dfrm, file="yj_ElKalaa_Trans.csv", sep=",", row.names=FALSE, col.names=TRUE)

#Shapes after the transformation
#Demo data ElKaala Province growth rates
GrowthRates <- read.csv("yj_ElKalaa_Trans.csv")
 

# Distribution of Plantation growth rate variable
ggdensity(GrowthRates, x = "yj_Plantation_vals", fill = "lightgray", title = "yj_Plantation_vals") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Distribution of crops growth rate variable
ggdensity(GrowthRates, x = "yj_Crops_vals", fill = "lightgray", title = "yj_Crops_vals") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Distribution of Rainfed growth rate variable
ggdensity(GrowthRates, x = "yj_Rainfed_vals", fill = "lightgray", title = "yj_Rainfed_vals") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Distribution of Irrigated growth rate variable
ggdensity(GrowthRates, x = "yj_Irrigated_vals", fill = "lightgray", title = "yj_Irrigated_vals") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")
# Distribution of Total_Agri variable

ggdensity(GrowthRates, x = "yj_Total_vals", fill = "lightgray", title = "yj_Total_vals") +
  stat_overlay_normal_density(color = "red", linetype = "dashed")


```

```{r}
#The extrapolation code is working perfect
library(forecast)
h <- 32
x <- read.csv("yj_ElKalaa_Trans.csv")
marathon <- ts(x$yj_Crops_vals, start = 2004, end = 2018)
#marathon <- ts(x[,2:length(x)], start = 2004, end = 2018)
fit.lin <- tslm(marathon ~ trend)
fcasts.lin <- forecast(fit.lin, h = h)
#fit.exp <- tslm(marathon ~ trend, lambda = 0)

#fcasts.exp <- forecast(fit.exp, h = h)

t <- time(marathon)
t.break1 <- 2030
t.break2 <- 2040
tb1 <- ts(pmax(0, t - t.break1), start = 2004)
tb2 <- ts(pmax(0, t - t.break2), start = 2004)

fit.pw <- tslm(marathon ~ t + tb1 + tb2)
t.new <- t[length(t)] + seq(h)
tb1.new <- tb1[length(tb1)] + seq(h)
tb2.new <- tb2[length(tb2)] + seq(h)

newdata <- cbind(t=t.new, tb1=tb1.new, tb2=tb2.new) %>%
  as.data.frame()
fcasts.pw <- forecast(fit.pw, newdata = newdata)

fit.spline <- tslm(marathon ~ t + I(t^2) + I(t^3) +
  I(tb1^3) + I(tb2^3))
fcasts.spl <- forecast(fit.spline, newdata = newdata)



autoplot(marathon) +
  autolayer(fitted(fit.lin), series = "Linear") +
  #autolayer(fitted(fit.exp), series = "Exponential") +
  autolayer(fitted(fit.pw), series = "Piecewise") +
  autolayer(fitted(fit.spline), series = "Cubic Spline") +
  autolayer(fcasts.pw, series="Piecewise") +
  autolayer(fcasts.lin, series="Linear", PI=FALSE) +
  #autolayer(fcasts.exp, series="Exponential", PI=FALSE) +
  autolayer(fcasts.spl, series="Cubic Spline", PI=FALSE) +
  xlab("Year") + ylab("LC Growth rate") +
  ggtitle("Growth Demand") +
  guides(colour = guide_legend(title = " "))

 
#storing in a file
dfrm_fcasts <- data.frame(fcasts.pw=fcasts.pw,fcasts.lin=fcasts.lin,fcasts.spl=fcasts.spl)
write.table(dfrm_fcasts, file="yj_ElKalaa_Trans_fcasts.csv", sep=",", row.names=FALSE, col.names=TRUE)


x <- read.csv("yj_ElKalaa_Trans_fcasts.csv")

yj_obj <- yeojohnson(x$fcasts.spl.Point.Forecast,standardize=TRUE)

orig_vals <- predict(yj_obj, newdata = x$fcasts.spl.Point.Forecast, inverse = TRUE)
write.table(orig_vals, file="yj_ElKalaa_fcasts_origvals.csv", sep=",", row.names=FALSE, col.names=TRUE)


```


```{r}
#source:https://stats.stackexchange.com/questions/43482/transformation-to-increase-kurtosis-and-skewness-of-normal-r-v
# the degree for the different grades of skewness is working perfectly
fs = function(x,epsilon,delta) dnorm(sinh(delta*asinh(x)-epsilon))*delta*cosh(delta*asinh(x)-epsilon)/sqrt(1+x^2)

GrowthRates <- read.csv("normal_trans02.csv")


GR = seq(-5,5,0.0001)#GrowthRates$transformed#

plot(GR,fs(GR,0,1), 
     type="l",     
    lty=1,              # Line type: 0=blank, 1=solid, 2=dashed, 3=dotted, 4=dotdash, 5=longdash, 6=twodash  
     ,col="black")
points(vec,fs(vec,1,1),type="l",lty=2,col="green")
points(vec,fs(vec,2,1),type="l",lty=2,col="blue")
points(vec,fs(vec,3,1),type="l",lty=2,col="pink")
points(vec,fs(vec,-1,1),type="l",lty=2,col="brown")
points(vec,fs(vec,-2,1),type="l",lty=2,col="red")
points(vec,fs(vec,-3,1),type="l",lty=2,col="grey")

```


